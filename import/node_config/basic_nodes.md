# Coze平台基本节点配置文档

本文档记录了Coze平台中常用的基本节点类型、配置参数和使用方法。

## 1. 代码节点

### 功能描述
- 编写代码，处理输入变量并生成返回值
- 支持JavaScript/TypeScript编程
- 可用于复杂逻辑处理和数据转换

### 界面组成
- **输入部分**：定义参数名和参数值
  - 参数名：如"input"
  - 参数类型：如"str"（字符串类型）
  - 可输入或引用参数值
- **代码部分**：编写处理逻辑
  - 可通过'params'获取输入参数
  - 示例：`const input = params.input;`
  - 可返回包含多种数据类型的对象
  - 示例：`const ret = { "name": "小明", "hobby": "读书" };`
- **输出部分**：定义输出变量
  - 变量名：如"key0"、"key1"、"key2"等
  - 变量类型：如"str.String"、"[].Array"、"{}.Object"等
  - 可设置嵌套结构，如Object中包含String类型的子属性

### 异常忽略
- 可设置是否忽略异常
- 当异常发生时使用默认输出替代

### 使用场景
- 数据格式转换
- 复杂条件判断
- 自定义算法实现
- API响应处理

## 2. 选择器节点

### 功能描述
- 连接多个下游分支
- 根据设定条件选择执行路径
- 支持条件判断和分支执行

### 界面组成
- **条件分支**：
  - "如果"条件：设置条件表达式
  - 条件操作符：可选择比较操作符
  - 条件值：输入或引用参数值
  - "新增"按钮：添加多个条件
- **否则分支**：
  - 当所有条件不满足时执行的默认分支

### 使用场景
- 多路径工作流
- 条件判断和分支处理
- 错误处理和异常流程

## 3. 意图识别节点

### 功能描述
- 用于用户输入的意图识别
- 将用户输入与预设意图进行匹配
- 支持极速模式和完整模式

### 界面组成
- **输入部分**：
  - 参数名：如"query"
  - 参数类型：通常为"str"（字符串类型）
- **意图匹配部分**：
  - 可添加多个意图描述
  - 其他意图：未匹配到预设意图时的默认分类
- **输出部分**：
  - classificationId：Integer类型，表示匹配到的意图ID

### 使用场景
- 用户查询分类
- 智能客服问题分流
- 多功能机器人的功能分发

## 4. 循环节点

### 功能描述
- 用于通过设定循环次数和逻辑，重复执行一系列任务
- 支持数组循环和自定义循环

### 界面组成
- **循环设置**：
  - 循环类型：如"使用数组循环"
- **循环数据**：
  - 参数名：如"input"
  - 参数类型：通常为数组类型"[str]"
- **中间变量**：
  - 可定义循环过程中的临时变量
- **输出部分**：
  - 输出变量名：如"output"
  - 变量类型：如"str"
  - 可引用参数值或新数据

### 使用场景
- 批量数据处理
- 重复执行特定任务
- 数组元素遍历

## 5. 批处理节点

### 功能描述
- 通过设定批量运行次数和逻辑，运行批处理体内的任务
- 支持并行执行多个任务

### 界面组成
- **批处理设置**：
  - 并行运行数量：如"10"（整数类型）
  - 批处理次数上限：如"100"（整数类型）
- **输入部分**：
  - 参数名：如"input"
  - 参数类型：通常为数组类型"[str]"
- **输出部分**：
  - 输出变量名：如"output"
  - 变量类型：如"str"
  - 可引用参数值或新数据

### 使用场景
- 大规模数据处理
- 并行任务执行
- 性能优化

## 6. 变量聚合节点

### 功能描述
- 对多个分支的输出进行聚合处理
- 支持返回每个分组中第一个非空的值
- 用于合并多路径的处理结果

### 界面组成
- **聚合策略**：
  - 返回每个分组中第一个非空的值
- **分组配置**：
  - Group1：str类型
  - 可通过"新增分组"按钮添加更多分组
- **输入引用**：支持输入或引用参数值

### 使用场景
- 多分支结果合并
- 数据聚合处理
- 条件分支结果整合

## 7. SQL自定义节点

### 功能描述
- 基于用户自定义的SQL完成对数据库的增删改查操作
- 支持参数化查询
- 提供灵活的数据操作能力

### 界面组成
- **输入部分**：
  - 参数名：input
  - 参数类型：str类型
  - 支持输入或引用参数值
- **数据表**：支持添加数据表配置
- **SQL编辑器**：
  - 支持变量引用：{{变量名}}、{{变量名.子变量名}}、{{变量名[数组索引]}}
- **输出部分**：
  - outputList：Array类型，返回查询结果集
  - rowNum：Integer类型，返回影响行数

### 使用场景
- 数据库操作
- 自定义查询
- 数据统计分析

## 8. 新增数据节点

### 功能描述
- 向表添加新数据记录
- 用户输入数据内容后插入数据库
- 支持批量数据插入

### 界面组成
- **数据表**：选择目标数据表
- **输出部分**：
  - outputList：Array类型，返回插入结果
  - rowNum：Integer类型，返回插入行数

### 使用场景
- 数据录入
- 批量数据导入
- 记录保存

## 9. 输入节点

### 功能描述
- 支持中间过程的信息输入
- 提供灵活的数据输入接口
- 支持多种数据类型

### 界面组成
- **输入部分**：
  - 变量名：input
  - 变量类型：str.String
  - 必填选项：支持设置是否必填
  - 长度限制：如5/20表示当前长度/最大长度

### 使用场景
- 用户数据收集
- 流程中的动态输入
- 参数配置

### 使用建议
1. 设置合适的变量名和类型
2. 添加必要的输入验证
3. 考虑数据格式和长度限制

## 10. 查询数据节点

### 功能描述
- 从表获取数据，用户可定义查询条件、选择列等
- 输出符合条件的数据
- 支持灵活的数据查询操作

### 界面组成
- **数据表部分**：
  - 支持添加一个数据表
  - 右上角"+"按钮添加数据表
- **输出部分**：
  - outputList：Array类型，返回查询结果集
  - rowNum：Integer类型，返回查询结果数量

### 使用场景
- 数据查询和检索
- 条件筛选
- 数据统计分析

## 11. 更新数据节点

### 功能描述
- 修改表中已存在的数据记录
- 用户指定更新条件和内容来更新数据
- 支持批量更新操作

### 界面组成
- **数据表部分**：
  - 支持添加一个数据表
  - 右上角"+"按钮添加数据表
- **输出部分**：
  - outputList：Array类型，返回更新结果
  - rowNum：Integer类型，返回更新行数

### 使用场景
- 数据更新维护
- 批量数据修改
- 状态更新操作

## 12. 删除数据节点

### 功能描述
- 从表中删除数据记录
- 用户指定删除条件来删除符合条件的记录
- 支持批量删除操作

### 界面组成
- **数据表部分**：
  - 支持添加一个数据表
  - 右上角"+"按钮添加数据表
- **输出部分**：
  - outputList：Array类型，返回删除结果
  - rowNum：Integer类型，返回删除行数

### 使用场景
- 数据清理
- 记录删除
- 批量数据移除

## 13. 清除上下文节点

### 功能描述
- 用于清空对话历史
- 清空LLM节点看到的对话历史为空
- 重置会话状态

### 界面组成
- **输入部分**：
  - conversationName：String类型，必填，会话名称
- **输出部分**：
  - isSuccess：Boolean类型，表示操作是否成功

### 使用场景
- 会话重置
- 上下文清理
- 新对话开始

## 14. 创建会话节点

### 功能描述
- 用于创建新的会话
- 初始化会话环境
- 生成会话标识

### 界面组成
- **输入部分**：
  - conversationName：String类型，必填，会话名称
- **输出部分**：
  - isSuccess：Boolean类型，表示操作是否成功
  - isExisted：Boolean类型，表示会话是否已存在
  - conversationId：String类型，会话唯一标识

### 使用场景
- 新对话创建
- 多轮对话初始化
- 会话管理

## 15. 查询消息列表节点

### 功能描述
- 用于查询消息列表
- 支持分页和条件查询
- 获取历史对话记录

### 界面组成
- **输入部分**：
  - conversationName：String类型，必填，会话名称
  - limit：Integer类型，限制返回消息数量
  - beforeId：String类型，查询此ID之前的消息
  - afterId：String类型，查询此ID之后的消息
- **输出部分**：
  - messageList：Array<Object>类型，包含以下字段：
    - messageId：String类型，消息ID
    - role：String类型，发送者角色
    - contentType：String类型，内容类型
    - content：String类型，消息内容
  - firstId：String类型，第一条消息ID
  - lastId：String类型，最后一条消息ID
  - hasMore：Boolean类型，是否还有更多消息

### 使用场景
- 历史记录查询
- 消息追溯
- 对话回顾

## 16. 变量赋值节点

### 功能描述
- 用于给支持写入的变量赋值
- 包括对话应用变量、用户变量
- 支持多种数据类型的赋值操作

### 界面组成
- **输入部分**：
  - 参数名：下拉选择框，选择要赋值的变量
  - 变量类型：str类型
  - 参数值：输入或引用参数值
  - 添加按钮：右上角"+"按钮
- **输出部分**：
  - isSuccess：boolean类型，表示赋值操作是否成功

### 使用场景
- 变量初始化
- 状态更新
- 数据传递
- 全局变量管理

### 使用建议
1. 合理规划变量作用域
2. 注意变量类型匹配
3. 避免循环引用
4. 及时清理无用变量

## 17. 长期记忆节点

### 功能描述
- 用于调用长期记忆，获取用户的个性化信息
- 智能体必须打开长期记忆
- 支持用户历史信息的存储和检索

### 界面组成
- **输入部分**：
  - Query：str类型，输入或引用参数值
- **输出部分**：
  - outputList：Array<Object>类型，包含以下字段：
    - output：String类型，记忆内容
    - date：String类型，记忆时间

### 使用场景
- 个性化对话
- 用户偏好记忆
- 历史信息检索

## 18. 知识库检索节点

### 功能描述
- 在选定的知识中根据输入变量召回最匹配的信息
- 以列表形式返回匹配结果
- 支持语义化检索

### 界面组成
- **输入部分**：
  - Query：String类型，必填，检索关键词
- **知识库部分**：
  - 支持添加知识库
  - 右上角"+"按钮添加知识库
- **输出部分**：
  - outputList：Array<Object>类型，包含检索结果
    - output：String类型，匹配内容

### 使用场景
- 知识检索
- 智能问答
- 文档查询

## 19. 知识库写入节点

### 功能描述
- 写入节点只可以添加文本类型的知识库
- 仅可以添加一个知识库
- 支持文件上传和写入

### 界面组成
- **输入部分**：
  - knowledgeFile：File/Doc类型，支持上传文件
- **知识库部分**：
  - 支持添加一个文档类型知识库
  - 右上角"+"按钮添加知识库
- **输出部分**：
  - documentId：String类型，文档唯一标识
  - fileName：String类型，文件名称
  - fileUrl：String类型，文件访问地址

### 使用场景
- 知识库构建
- 文档管理
- 资料存储

## 20. 图像生成节点

### 功能描述
- 通过文字描述/添加参考图生成图片
- 支持多种模型和参数配置
- 提供灵活的图像生成控制

### 界面组成
- **模型设置**：
  - 模型：下拉选择框，如"通用"等
  - 比例：支持预设尺寸（如1:1 1024*1024）
  - 宽度和高度：可自定义设置，如1024
  - 生成质量：滑动条控制
- **参考图**：
  - 支持添加参考图片
  - 可设置参考程度
- **输入部分**：
  - 支持添加输入参数
- **提示词部分**：
  - 正向提示词：必填，用于描述要生成的图像内容
  - 负向提示词：用于描述不希望在生成图像中出现的内容
- **输出部分**：
  - data：Image类型，生成的图像数据

### 使用场景
- 图像创作
- 艺术设计
- 视觉内容生成

## 21. SD优化提示词节点

### 功能描述
- 智能优化图像提示词
- 支持单次处理和批处理模式
- 提供提示词优化建议

### 界面组成
- **输入部分**：
  - 提示词：str类型，必填，输入或引用参数值
- **输出部分**：
  - data：String类型，优化后的提示词
  - msg：String类型，优化相关信息
- **异常忽略**：
  - 可选择是否忽略异常并在异常发生时使用默认输出替代

### 使用场景
- 提示词优化
- 图像生成效果提升
- 批量图像处理

### 使用建议
1. 提供清晰、具体的描述
2. 注意关键词的优先级
3. 合理使用正向和负向提示词
4. 参考优化建议进行调整

## 22. 图片理解节点

### 功能描述
- 回答用户关于代表URL的图片的问题
- 支持图像内容分析和理解
- 提供智能问答功能

### 界面组成
- **输入部分**：
  - 参数名：如"imageUrl"
  - 参数类型：str类型，图片URL地址
- **输出部分**：
  - data：String类型，图片理解结果
  - msg：String类型，处理相关信息

### 使用场景
- 图像内容分析
- 智能图片问答
- 视觉内容理解

## 23. 图像质量提升节点

### 功能描述
- 提升图像清晰度
- 支持多种图像优化处理
- 4倍提升画面质量

### 界面组成
- **输入部分**：
  - 原图：Image类型，必填，上传图片
- **输出部分**：
  - data：Image类型，优化后的图片
  - msg：String类型，处理信息

### 使用场景
- 图片清晰度提升
- 图像质量优化
- 老照片修复

## 24. 智能抠图节点

### 功能描述
- 保留图片前景主体
- 输出透明背景图片(png)
- 支持批量处理

### 界面组成
- **输入部分**：
  - 上传图：Image类型，必填
  - 输出图模式：选择"透明背景图"
  - 提示词：str类型，输入引用参数值
- **输出部分**：
  - mask：String类型，蒙版数据
  - msg：String类型，处理信息
  - data：Image类型，处理后的图片

### 使用场景
- 图片背景移除
- 产品图制作
- 素材处理

## 25. 文本处理节点

### 功能描述
- 用于处理多个字符串类型变量的格式
- 支持字符串拼接操作
- 灵活的文本处理功能

### 界面组成
- **选择应用**：字符串拼接
- **输入部分**：
  - String1：str类型，输入或引用参数值
  - 可添加多个输入参数
- **字符串拼接**：
  - 支持使用{{变量名}}、{{变量名.子变量名}}、{{变量名[数组索引]}}的方式引用输入参数中的变量
- **输出部分**：
  - output：String类型，处理后的文本

### 使用场景
- 文本拼接
- 变量组合
- 模板处理

## 最佳实践

### 节点组合建议
1. **数据处理流程**：
   - 输入节点 → 代码节点(数据处理) → 输出节点
   
2. **条件分支流程**：
   - 输入节点 → 选择器节点 → 多个处理分支 → 输出节点
   
3. **循环处理流程**：
   - 输入节点 → 代码节点(准备数据) → 循环节点 → 输出节点
   
4. **批量处理流程**：
   - 输入节点 → 代码节点(准备数据) → 批处理节点 → 输出节点

### 性能优化建议
1. 代码节点中避免复杂计算，必要时拆分为多个节点
2. 批处理节点中合理设置并行数量，避免资源过度占用
3. 循环节点中注意终止条件，避免无限循环
4. 选择器节点中条件判断从简，避免过度复杂的条件表达式

## 26. HTTP请求节点

### 功能描述
- 用于发送API请求，从接口返回数据
- 支持多种HTTP方法
- 提供完整的请求配置选项

### 界面组成
- **API部分**：
  - 请求方法：GET/POST等
  - URL：支持使用{{}}引用变量
- **请求参数**：
  - 参数配置：支持添加多个参数
- **请求头**：
  - 自定义请求头配置
- **请求体**：
  - 支持none等多种格式
- **超时设置**：
  - 超时时间（秒）：默认120
- **重试次数**：
  - 默认3次
- **输出部分**：
  - body：String类型，响应体
  - statusCode：Integer类型，状态码
  - headers：String类型，响应头

### 使用场景
- API调用
- 数据获取
- 服务集成

## 27. 问答节点

### 功能描述
- 支持中间向用户提问题
- 支持预置选项提问和开放式问题提问两种方式
- 灵活的交互方式

### 界面组成
- **模型**：
  - 支持选择不同的模型
- **输入部分**：
  - 可使用{{变量名}}的方式引用输入参数中的变量
- **提问内容**：
  - 文本输入区域
- **回答类型**：
  - 直接回答
  - 选项回答
- **输出部分**：
  - USER_RESPONSE：str.String类型，用户回答内容

### 使用场景
- 用户交互
- 信息收集
- 选项确认

## 28. ByteArtist节点

### 功能描述
- 根据文本描述生成图像
- 可指定图像数量和大小
- 支持多种生成参数配置

### 界面组成
- **输入部分**：
  - 提示词：String类型，描述要生成的图像
  - 参数配置：尺寸、数量等
- **输出部分**：
  - data：Image类型，生成的图像
  - msg：String类型，处理信息

### 使用场景
- AI绘画
- 创意设计
- 视觉内容生成

## 29. 智能扩图节点

### 功能描述
- 为图像扩充相应范围的内容
- 智能内容生成
- 自然边缘过渡

### 界面组成
- **输入部分**：
  - 原图：Image类型，必填
  - 扩展设置：方向、范围等
- **输出部分**：
  - data：Image类型，扩展后的图片
  - msg：String类型，处理信息

### 使用场景
- 图像扩展
- 场景补充
- 创意编辑

## 30. 缩放节点

### 功能描述
- 按设定的长边/短边的尺寸缩放图片
- 支持精确尺寸控制
- 保持图像比例

### 界面组成
- **输入部分**：
  - 原图：Image类型，必填
  - 缩放设置：尺寸参数
- **输出部分**：
  - data：Image类型，缩放后的图片
  - msg：String类型，处理信息

### 使用场景
- 图片尺寸调整
- 批量图片处理
- 展示图制作

## 31. 旋转节点

### 功能描述
- 旋转图片
- 支持自定义角度
- 保持图像质量

### 界面组成
- **输入部分**：
  - 原图：Image类型，必填
  - 旋转角度：数值输入
- **输出部分**：
  - data：Image类型，旋转后的图片
  - msg：String类型，处理信息

### 使用场景
- 图片方向调整
- 创意设计
- 批量处理

## 32. 叠图节点

### 功能描述
- 为图片添加图片
- 支持位置和大小调整
- 多图层叠加功能

### 界面组成
- **输入部分**：
  - 原图：Image类型，必填
  - 叠加图：Image类型，必填
- **输出部分**：
  - data：Image类型，叠加后的图片
  - msg：String类型，处理信息

### 使用场景
- 图片合成
- 水印添加
- 创意设计

## 33. 光影融合节点

### 功能描述
- 让画面融合光影图的光影
- 支持自然光效处理
- 提供多种融合模式

### 界面组成
- **输入部分**：
  - 原图：Image类型，必填
  - 光影图：Image类型，必填
- **输出部分**：
  - data：Image类型，处理后的图片
  - msg：String类型，处理信息

### 使用场景
- 光影效果处理
- 艺术创作
- 氛围营造

## 34. 调整节点

### 功能描述
- 调整图片的亮度、对比度、饱和度
- 支持精确参数控制
- 专业图像调节功能

### 界面组成
- **输入部分**：
  - 原图：Image类型，必填
  - 参数设置：
    - 亮度
    - 对比度
    - 饱和度
- **输出部分**：
  - data：Image类型，调整后的图片
  - msg：String类型，处理信息

### 使用场景
- 图像优化
- 色彩调整
- 效果微调

## 35. 美颜节点

### 功能描述
- 一键智能美颜
- 支持多种美颜参数
- 自然美化效果

### 界面组成
- **输入部分**：
  - 原图：Image类型，必填
  - 美颜参数：强度等
- **输出部分**：
  - data：Image类型，美颜后的图片
  - msg：String类型，处理信息

### 使用场景
- 人像美化
- 照片优化
- 批量处理

## 最佳实践

### 图像处理流程建议
1. **基础图像处理流程**：
   - 输入图片 → 尺寸调整 → 基础处理 → 输出图片
   
2. **高级效果处理流程**：
   - 输入图片 → 智能处理 → 效果叠加 → 参数调整 → 输出图片
   
3. **批量处理流程**：
   - 图片集输入 → 批处理节点 → 并行处理 → 结果合并 → 输出

### 性能优化建议
1. 合理设置图片尺寸，避免处理过大图片
2. 批量处理时注意控制并发数量
3. 合理组合处理节点，减少中间文件生成
4. 注意临时文件的及时清理
