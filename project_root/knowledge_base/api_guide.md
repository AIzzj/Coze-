# 扣子平台API调用指南

## 一、基础信息

### 1. 用户类型及权限
- **基础版用户**：
  - 免费使用API，有额度限制
  - API调用次数限制：100次/账号
  - 模型流控：2 QPS, 60 QPM, 3000 QPD

- **专业版用户**：
  - 按使用量计费
  - API调用更高限制
  - 可调整模型流控（最大12000 RPM）

### 2. API限制说明
```json
{
    "请求体限制": {
        "工作流相关API": "50MB",
        "其他API": "15MB"
    },
    "流控策略": {
        "基础版": {
            "对话API": "10 QPS",
            "工作流API": "100 QPS"
        },
        "专业版": {
            "对话API": "100 QPS",
            "工作流API": "100 QPS"
        }
    }
}
```

## 二、认证方式

### 1. 访问令牌类型
- **个人访问令牌**：
  - 有效期一天以上
  - 适用于测试场景
  - 可调整权限和期限
  - 生成方式简单

- **OAuth访问令牌**：
  - 有效期分钟级
  - 适用于生产环境
  - 安全性较高
  - 支持标准OAuth流程

### 2. 获取访问令牌
1. 登录扣子平台
2. 进入API授权页面
3. 选择令牌类型
4. 配置权限和期限
5. 生成并保存令牌

## 三、API调用示例

### 1. 基础对话调用
```bash
curl --location --request POST 'https://api.coze.cn/v3/chat' \
--header 'Authorization: Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \
--header 'Content-Type: application/json' \
--data-raw '{
    "bot_id": "73428668*****",
    "user_id": "123123***",
    "stream": false,
    "auto_save_history":true,
    "additional_messages":[
        {
            "role":"user",
            "content":"早上好",
            "content_type":"text"
        }
    ]
}'
```

### 2. 工作流调用
```json
{
    "基本参数": {
        "workspace_id": "工作空间ID",
        "workflow_id": "工作流ID",
        "version": "版本号",
        "async": "是否异步"
    },
    "注意事项": [
        "确保工作流已发布",
        "检查参数完整性",
        "处理异步响应",
        "注意超时限制"
    ]
}
```

## 四、最佳实践

### 1. 错误处理
- 检查状态码
- 解析错误信息
- 实现重试机制
- 记录错误日志

### 2. 性能优化
- 使用连接池
- 控制并发请求
- 实现缓存机制
- 监控API性能

### 3. 安全建议
- 安全存储令牌
- 及时更新过期令牌
- 使用HTTPS
- 实现访问控制

## 五、常见问题

### 1. 调用失败处理
- 检查认证信息
- 验证参数格式
- 确认API权限
- 查看错误日志

### 2. 限流处理
- 实现限流控制
- 错峰调用
- 优化调用频率
- 监控使用量

### 3. 版本管理
- 关注API更新
- 适配版本变化
- 测试新特性
- 平滑升级 